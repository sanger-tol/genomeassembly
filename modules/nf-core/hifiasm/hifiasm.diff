Changes in component 'nf-core/hifiasm'
'modules/nf-core/hifiasm/environment.yml' is unchanged
'modules/nf-core/hifiasm/meta.yml' is unchanged
Changes in 'hifiasm/main.nf':
--- modules/nf-core/hifiasm/main.nf
+++ modules/nf-core/hifiasm/main.nf
@@ -4,27 +4,27 @@
 
     conda "${moduleDir}/environment.yml"
     container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        'https://depot.galaxyproject.org/singularity/hifiasm:0.24.0--h5ca1c30_0' :
-        'biocontainers/hifiasm:0.24.0--h5ca1c30_0' }"
+        'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/70/709c9b732af5bc95b8f02346f374b8d9ef815087e30a969410d5e385625bf7a9/data' :
+        'community.wave.seqera.io/library/hifiasm_samtools:7f8aef13225935f4' }"
 
     input:
     tuple val(meta) , path(long_reads)        , path(ul_reads)
     tuple val(meta1), path(paternal_kmer_dump), path(maternal_kmer_dump)
-    tuple val(meta2), path(hic_read1)         , path(hic_read2)
+    tuple val(meta2), path(hic_reads)
     tuple val(meta3), path(bin_files)
 
     output:
-    tuple val(meta), path("*.r_utg.gfa")                             , emit: raw_unitigs
-    tuple val(meta), path("*.bin")                                   , emit: bin_files        , optional: true
-    tuple val(meta), path("*.p_utg.gfa")                             , emit: processed_unitigs, optional: true
-    tuple val(meta), path("${prefix}.{p_ctg,bp.p_ctg,hic.p_ctg}.gfa"), emit: primary_contigs  , optional: true
-    tuple val(meta), path("${prefix}.{a_ctg,hic.a_ctg}.gfa")         , emit: alternate_contigs, optional: true
-    tuple val(meta), path("${prefix}.*.hap1.p_ctg.gfa")              , emit: hap1_contigs     , optional: true
-    tuple val(meta), path("${prefix}.*.hap2.p_ctg.gfa")              , emit: hap2_contigs     , optional: true
-    tuple val(meta), path("*.ec.fa.gz")                              , emit: corrected_reads  , optional: true
-    tuple val(meta), path("*.ovlp.paf.gz")                           , emit: read_overlaps    , optional: true
-    tuple val(meta), path("${prefix}.stderr.log")                    , emit: log
-    path  "versions.yml"                                             , emit: versions
+    tuple val(meta), path("*.r_utg.gfa.gz")                             , emit: raw_unitigs      , optional: true
+    tuple val(meta), path("*.bin")                                      , emit: bin_files        , optional: true
+    tuple val(meta), path("*.p_utg.gfa.gz")                             , emit: processed_unitigs, optional: true
+    tuple val(meta), path("${prefix}.{p_ctg,bp.p_ctg,hic.p_ctg}.gfa.gz"), emit: primary_contigs  , optional: true
+    tuple val(meta), path("${prefix}.{a_ctg,hic.a_ctg}.gfa.gz")         , emit: alternate_contigs, optional: true
+    tuple val(meta), path("${prefix}.*.hap1.p_ctg.gfa.gz")              , emit: hap1_contigs     , optional: true
+    tuple val(meta), path("${prefix}.*.hap2.p_ctg.gfa.gz")              , emit: hap2_contigs     , optional: true
+    tuple val(meta), path("*.ec.fa.gz")                                 , emit: corrected_reads  , optional: true
+    tuple val(meta), path("*.ovlp.paf.gz")                              , emit: read_overlaps    , optional: true
+    tuple val(meta), path("${prefix}.stderr.log")                       , emit: log
+    path  "versions.yml"                                                , emit: versions
 
     when:
     task.ext.when == null || task.ext.when
@@ -37,7 +37,7 @@
     def ul_reads_sorted = ul_reads instanceof List ? ul_reads.sort{ it.name } : ul_reads
     def ultralong = ul_reads ? "--ul ${ul_reads_sorted}" : ""
 
-    if([paternal_kmer_dump, maternal_kmer_dump].any() && [hic_read1, hic_read2].any()) {
+    if([paternal_kmer_dump, maternal_kmer_dump].any() && hic_reads) {
         log.error("ERROR: hifiasm trio binning mode and Hi-C phasing can not be used at the same time.")
     }
 
@@ -50,20 +50,21 @@
         }
     }
 
-    def input_hic = ""
-    if([hic_read1, hic_read2].any()) {
-        if(![hic_read1, hic_read2].every()) {
-            log.error("ERROR: Either the forward or reverse Hi-C reads are missing!")
-        } else {
-            input_hic = "--h1 ${hic_read1} --h2 ${hic_read2}"
-        }
+    if(hic_reads) {
+        def input_hic1 = "--h1 <(for f in ${hic_reads}; do samtools cat \$f | samtools fastq -n -f0x40 -F0xB00; done)"
+        def input_hic2 = "--h2 <(for f in ${hic_reads}; do samtools cat \$f | samtools fastq -n -f0x80 -F0xB00; done)"
+        """
+    } else {
+        def input_hic1 = ""
+        def input_hic2 = ""
     }
     """
     hifiasm \\
         $args \\
         -t ${task.cpus} \\
         ${input_trio} \\
-        ${input_hic} \\
+        ${input_hic1} \\
+        ${input_hic2} \\
         ${ultralong} \\
         -o ${prefix} \\
         ${long_reads_sorted} \\
@@ -77,27 +78,31 @@
         gzip ${prefix}.ovlp.paf
     fi
 
+    // gzip all GFA output files
+    find . -name "*.gfa" -exec gzip {} \;
+
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":
         hifiasm: \$(hifiasm --version 2>&1)
+        samtools: \$(samtools --version |& sed '1!d ; s/samtools //')
     END_VERSIONS
     """
 
     stub:
     prefix = task.ext.prefix ?: "${meta.id}"
     """
-    touch ${prefix}.r_utg.gfa
     touch ${prefix}.ec.bin
     touch ${prefix}.ovlp.source.bin
     touch ${prefix}.ovlp.reverse.bin
     touch ${prefix}.hic.tlb.bin
     touch ${prefix}.hic.lk.bin
-    touch ${prefix}.bp.p_ctg.gfa
-    touch ${prefix}.p_utg.gfa
-    touch ${prefix}.p_ctg.gfa
-    touch ${prefix}.a_ctg.gfa
-    touch ${prefix}.hap1.p_ctg.gfa
-    touch ${prefix}.hap2.p_ctg.gfa
+    echo "" | gzip ${prefix}.r_utg.gfa.gz
+    echo "" | gzip ${prefix}.bp.p_ctg.gfa.gz
+    echo "" | gzip ${prefix}.p_utg.gfa.gz
+    echo "" | gzip ${prefix}.p_ctg.gfa.gz
+    echo "" | gzip ${prefix}.a_ctg.gfa.gz
+    echo "" | gzip ${prefix}.hap1.p_ctg.gfa.gz
+    echo "" | gzip ${prefix}.hap2.p_ctg.gfa.gz
     echo "" | gzip > ${prefix}.ec.fa.gz
     echo "" | gzip > ${prefix}.ovlp.paf.gz
     touch ${prefix}.stderr.log
@@ -105,6 +110,7 @@
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":
         hifiasm: \$(hifiasm --version 2>&1)
+        samtools: \$(samtools --version |& sed '1!d ; s/samtools //')
     END_VERSIONS
     """
 }

'modules/nf-core/hifiasm/tests/main.nf.test.snap' is unchanged
'modules/nf-core/hifiasm/tests/nextflow.config' is unchanged
'modules/nf-core/hifiasm/tests/main.nf.test' is unchanged
************************************************************
