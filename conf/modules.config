/*
re114
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

myfunctions {
    assemblyDir = { meta, starttime ->
        def dir  = meta.assembly_type == "hic_phased" ? "hifiasm-hic" : meta.assembly_type == "trio_binned" ? "hifiasm-trio" : "hifiasm"
        def date = "${starttime.format('yyyyMMdd')}"
        return "${meta.id}.${dir}.${date}"
    }
}

process {

    withName: BCFTOOLS_CONSENSUS {
        // Filter by mapping quality, keep alt-alt het and alt-alt hom,
        // keep longer allele
        ext.args = '-i\'QUAL>1 && (GT="AA" || GT="Aa")\' -Hla'
        ext.prefix = { "${meta.id}_${meta.assembly_type}.consensus" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.contains('*consensus.fa') ? "${meta.id}.consensus.fa" : null }
        ]
    }

    withName: BCFTOOLS_INDEX {
        ext.prefix = { "${meta.id}_${meta.assembly_type}_${meta.chunk_id}" }
        ext.args   = { "--tbi" }
    }

    withName: BCFTOOLS_NORM {
        ext.prefix = { "${meta.id}_${meta.assembly_type}_normalised" }
        ext.args = '--no-version'
    }

    withName: BCFTOOLS_SORT {
        ext.prefix = { "${meta.id}_${meta.assembly_type}_${meta.chunk_id}_sorted" }
        scratch = true
    }

    withName: BCFTOOLS_VIEW {
        ext.prefix = { "${meta.id}_${meta.assembly_type}_${meta.chunk_id}_view" }
        // Dont keep command line information, keep reference allele or
        // suggested alternative if reference is N
        ext.args = '--no-version -e\'type="ref"||REF~"N"\''
    }

    withName: CAT_PURGED_HAPS_TO_ALT {
        ext.prefix = { "${meta.id}.purged.htigs.all.fa" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.contains('purged.htigs.all.fa') ? 'purged.htigs.all.fa' : null }
        ]
    }

    // Set up of kmer profile
    withName: FASTK_FASTK {
        ext.args   = { "-k${params.kmer_size} -t -P." }
        ext.prefix = { "${meta.id}.${meta.read_type}.${params.kmer_size}" }
        tag        = { "${meta.id}.${meta.read_type}.${params.kmer_size}" }
        publishDir = [
            path: { "${params.outdir}/kmer" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: FASTK_HISTEX {
        ext.prefix = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        ext.args   = "-G"
        tag        = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        publishDir = [
            path: { "${params.outdir}/kmer" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: FREEBAYES {
        ext.prefix = { "${meta.id}.${meta.assembly_type}"       }
        ext.args   = { "--skip-coverage ${meta.longranger_cov}" }
        tag        = { "${meta.id}.${meta.assembly_type}"       }
        publishDir = [
            enabled: false
        ]
    }

    withName: GATK4_MERGE_FREEBAYES {
        ext.prefix = { "${meta.id}_${meta.assembly_type}_merged" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing" },
            mode: params.publish_dir_mode,
            pattern: "*merged*",
            saveAs: { filename -> filename.contains("*_merged.vcf.gz*") ? 'merged.vcf' : null }
        ]
    }

    withName: GAWK_BED_CHUNKS {
        ext.suffix = { "bed"                                       }
        ext.args   = {
            [
                "-v prefix=${meta.id}_${meta.assembly_type}",
                "-v chunk_size=${params.polishing_n_chunks_bed}"
            ].join(' ').trim()
        }
        tag        = { "${meta.id}_${meta.assembly_type}" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing/chunks/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: GAWK_GFA_TO_FASTA {
        ext.prefix = { "${input.toString() - ~/\.gfa\.gz/}"        }
        ext.suffix = { "fa"                                        }
        tag        = { "${meta.id}_${meta.assembly_type}" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: GENOMESCOPE2 {
        ext.prefix = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        ext.args   = { "-k${meta.kmer_size}"                            }
        tag        = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        publishDir = [
            path: { "${params.outdir}/kmer" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: HIFIASM_BIN {
        ext.prefix = { "${meta.id}" }
        tag        = { "${meta.id}" }
        ext.args   = {
            [
                "--bin-only",
                params.hifiasm_error_correction_options ? "${params.hifiasm_error_correction_options}" : ""
            ].join(" ").trim()
        }
        publishDir = [
            path: { "${params.outdir}/${meta.id}.hifiasm.${workflow.start.format('yyyyMMdd')}/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: HIFIASM {
        ext.prefix = { "${meta.id}"                                                             }
        tag        = { "${meta.id}_${meta.assembly_type}"                                       }
        ext.args   = {
            [
                params.hifiasm_error_correction_options ? "${params.hifiasm_error_correction_options}" : "",
                params.hifiasm_assembly_options ? "${params.hifiasm_assembly_options}" : ""
            ].join(" ").trim()
        }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: LONGRANGER_MKREF {
        if(System.getenv('GITHUB_ACTION') != null ) {
            container = "ghcr.io/sanger-tol/longranger:2.2.2-c4"
        } else {
            container = params.polishing_longranger_container_path
        }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: LONGRANGER_ALIGN {
        // Keep in sync with `longranger_lsf_sanger.config`
        ext.args = "--disable-ui --nopreflight"
        if(System.getenv('GITHUB_ACTION') != null ) {
            container = "ghcr.io/sanger-tol/longranger:2.2.2-c4"
        } else {
            container = params.polishing_longranger_container_path
        }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: MERQURYFK_HAPMAKER {
        ext.prefix = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        tag        = { "${meta.id}.${meta.read_type}.${meta.kmer_size}" }
        publishDir = [
            path: { "${params.outdir}/kmer/trio" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: MINIMAP2_ALIGN_ASSEMBLY {
        ext.args   = { "-xasm5 -DP -I" + Math.ceil(reads.size()/1e9) + "G" }
        ext.prefix = { "${meta.id}_${meta.assembly_type}.self_aln"         }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/coverage" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: MINIMAP2_ALIGN_READS {
        ext.args = {
            [
                //these options are from pbmm2 CSS preset
                "-k19 -w10 -O5,56 -E4,1 -A2 -B5 -z400,50 -r2000 --lj-min-ratio 0.5",
                "-I" + Math.ceil(reference.size()/1e9) + "G"
            ].join(' ').trim()
        }
        ext.prefix = { "${meta.id}_${meta.assembly_type}.reads" }
        tag        = { "${meta.id}_${meta.assembly_type}"       }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/coverage" },
            mode: params.publish_dir_mode,
            pattern: ".*paf"
        ]
    }

    withName: PURGEDUPS_PBCSTAT {
        ext.prefix = { "${meta.id}_${meta.assembly_type}" }
        tag        = { "${meta.id}_${meta.assembly_type}" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/coverage" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: PURGEDUPS_CALCUTS {
        ext.args = {
            def cov = meta.coverage + (meta.coverage / 2)
            def l = ""
            def m = "-m ${cov}"
            def u = "-u ${cov * 4}"
            if(params.purging_cutoffs) {
                def cut_list = params.purging_cutoffs.tokenize(",")
                if(cut_list.size() != 3) {
                    log.error("Error: only ${cut_list.size()} cutoffs provided instead of 3.")
                }
                l = "-l ${cut_list[0]}"
                m = "-m ${cut_list[1]}"
                u = "-u ${cut_list[2]}"
            }

            return "${l} ${m} ${u}".trim()
        }
        ext.prefix = { "${meta.id}_${meta.assembly_type}" }
        tag        = { "${meta.id}_${meta.assembly_type}" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/coverage" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: PURGEDUPS_PURGEDUPS {
        ext.args   = "-2"
        tag        = { "${meta.id}_${meta.assembly_type}" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/purge_dups" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: PURGEDUPS_SPLITFA {
        ext.prefix = { "${meta.id}_${meta.assembly_type}.self_aln" }
        tag        = { "${meta.id}_${meta.assembly_type}"          }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging/split_aln" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: PURGEDUPS_GETSEQS {
        ext.prefix = { "${meta.id}_${meta.assembly_type}" }
        tag        = { "${meta.id}_${meta.assembly_type}" }
        ext.args   = { params.purging_purge_middle ? "" : "-e" }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/purging" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.contains('purged.fa') ? 'purged.fa' : null }
        ]
    }

    withName: SEQKIT_GREP_SPLIT_HAPS {
        ext.prefix = { "${meta.id}_${meta.read_type}_${meta.haplotype}" }
        tag        = { "${meta.id}_${meta.read_type}_${meta.haplotype}" }
        ext.args   = {
            meta.haplotype == "hap1" ? "-rp '^h1tg|^ptg'" : "-rp '^h2tg|^atg'"
        }
        publishDir = [
            path: { "${params.outdir}/${myfunctions.assemblyDir(meta, workflow.start)}/polishing" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

    withName: YAK_COUNT {
        ext.prefix = { "${meta.id}_${meta.read_type}"     }
        ext.args   = { "-k${params.kmer_size}"            }
        tag        = { "${meta.id}_yak_${meta.read_type}" }
        publishDir = [
            path: { "${params.outdir}/kmer" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }

//    withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_PRI' {
//        ext.prefix = { "${meta.id}.asm.p_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_ALT' {
//        ext.prefix = { "${meta.id}.asm.a_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_RAW:GFASTATS_PRI' {
//        ext.prefix = { "${meta.id}.asm.p_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_RAW:GFASTATS_HAP' {
//        ext.prefix = { "${meta.id}.asm.a_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_RAW:BUSCO_PRI' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/${meta.id}.p_ctg.${meta.lineage}.busco" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                    filename.endsWith('full_table.tsv') ? filename :
//                    filename.endsWith('missing_busco_list.tsv') ? filename :
//                    filename.startsWith('short_summary') ? filename :
//                    filename.endsWith('busco.batch_summary.txt') ? filename :
//                    null }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_RAW:MERQURYFK_MERQURYFK' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/${meta.id}.p_ctg.ccs.merquryk" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    if (params.hifiasm_hic_on) {
//        withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_HAP1_HIC' {
//            ext.prefix = { "${meta.id}.asm.hic.hap1" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//
//        withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_HAP2_HIC' {
//            ext.prefix = { "${meta.id}.asm.hic.hap2" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//
//        withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_.*HIC' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//        withName: '.*GENOME_STATISTICS_RAW_HIC:GFASTATS_PRI' {
//            ext.prefix = { "${meta.id}.asm.hic.hap1" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}" },
//                mode: params.publish_dir_mode,
//                pattern: '*assembly_summary'
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_RAW_HIC:GFASTATS_HAP' {
//            ext.prefix = { "${meta.id}.asm.hic.hap2" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}" },
//                mode: params.publish_dir_mode,
//                pattern: '*assembly_summary'
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_RAW_HIC:BUSCO_PRI' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/${meta.id}.hap1.${meta.lineage}.busco" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                        filename.endsWith('full_table.tsv') ? filename :
//                        filename.endsWith('missing_busco_list.tsv') ? filename :
//                        filename.startsWith('short_summary') ? filename :
//                        filename.endsWith('busco.batch_summary.txt') ? filename :
//                        null }
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_RAW_HIC:BUSCO_HAP' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/${meta.id}.hap2.${meta.lineage}.busco" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                        filename.endsWith('full_table.tsv') ? filename :
//                        filename.endsWith('missing_busco_list.tsv') ? filename :
//                        filename.startsWith('short_summary') ? filename :
//                        filename.endsWith('busco.batch_summary.txt') ? filename :
//                        null }
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_RAW_HIC:MERQURYFK_MERQURYFK' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/${meta.id}.hap1.ccs.merquryk" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//    }
//
//    // End of Set up of the raw assembly pipeline
//
//    // Set up of organelles pipeline
//
//    if (params.organelles_on) {
//        withName: 'MITOHIFI_FINDMITOREFERENCE' {
//            ext.args = { "--min_length ${meta.min_length}" }
//        }
//
//        withName: '.*MITOHIFI_MITOHIFI_READS' {
//            ext.args2 = '-r'
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/mito.reads" },
//                mode: 'copyNoFollow',
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//
//        withName: '.*MITOHIFI_MITOHIFI_CONTIGS' {
//            ext.args2 = '-c'
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/mito" },
//                mode: 'copyNoFollow',
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//        withName: '.*ORGANELLES:OATK' {
//            ext.args = "-k1001 -c90 -Ttmp"
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/oatk" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//    }
//    // End of set up of organelles pipeline
//
//    // Set up of the purging pipeline
//
//    withName: '.*CAT_CAT_HAPLOTIGS' {
//        ext.prefix = { "purged.htigs.all.fa" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/purging/" },
//            mode: params.publish_dir_mode,
//            pattern: '*purged.htigs.all.fa'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_PURGED:GFASTATS_PRI' {
//        ext.prefix = { "purged" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/purging" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_PURGED:GFASTATS_HAP' {
//        ext.prefix = { "purged.htigs.all" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/purging" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_PURGED:BUSCO_PRI' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/purging/${meta.id}.purged.${meta.lineage}.busco" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                    filename.endsWith('full_table.tsv') ? filename :
//                    filename.endsWith('missing_busco_list.tsv') ? filename :
//                    filename.startsWith('short_summary') ? filename :
//                    filename.endsWith('busco.batch_summary.txt') ? filename :
//                    null }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_PURGED:MERQURYFK_MERQURYFK' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/purging/${meta.id}.purged.ccs.merquryk" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//    // End of Set up of the purging pipeline
//
//
//    // Set up of the polishing pipeline
//    if (params.polishing_on) {
//        withName: LONGRANGER_MKREF {
//            if(System.getenv('GITHUB_ACTION') != null ) {
//                container = "ghcr.io/sanger-tol/longranger:2.2.2-c4"
//            }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//
//        withName: LONGRANGER_ALIGN {
//            // Keep in sync with `longranger_lsf_sanger.config`
//            ext.args = "--disable-ui --nopreflight"
//            if(System.getenv('GITHUB_ACTION') != null ) {
//                container = "ghcr.io/sanger-tol/longranger:2.2.2-c4"
//            }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//
//        withName: BED_CHUNKS {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing/chunks" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//

//
//
//        withName: SEQTK_SUBSEQ_PRIMARY {
//            ext.prefix = 'primary'
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : "primary.fa" }
//            ]
//        }
//
//        withName: SEQTK_SUBSEQ_HAPLOTIGS {
//            ext.prefix = 'haplotigs'
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : "haplotigs.fa" }
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_POLISHED:GFASTATS_PRI' {
//            ext.prefix = { "primary" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                pattern: '*assembly_summary'
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_POLISHED:GFASTATS_HAP' {
//            ext.prefix = { "haplotigs" }
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing" },
//                mode: params.publish_dir_mode,
//                pattern: '*assembly_summary'
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_POLISHED:BUSCO' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing/${meta.id}.polished.${meta.lineage}.busco" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                        filename.endsWith('full_table.tsv') ? filename :
//                        filename.endsWith('missing_busco_list.tsv') ? filename :
//                        filename.startsWith('short_summary') ? filename :
//                        filename.endsWith('busco.batch_summary.txt') ? filename :
//                        null }
//            ]
//        }
//
//        withName: '.*GENOME_STATISTICS_POLISHED:MERQURYFK_MERQURYFK' {
//            publishDir = [
//                path: { "${params.outdir}/${meta.id}.${params.hifiasm}/polishing/${meta.id}.polished.ccs.merquryk" },
//                mode: params.publish_dir_mode,
//                saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//            ]
//        }
//    }
//    // End of Set up of the polishing pipeline
//
//
//    // Set up of the scaffolding pipeline
//
//    withName: '.*HIC_MAPPING:SAMTOOLS_MARKDUP_HIC_MAPPING' {
//        ext.prefix  = { "${meta.id}_mkdup" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING.*:SAMTOOLS_MERGE_HIC_MAPPING' {
//        ext.prefix  = { "${meta.id}_merged" }
//    }
//
//    withName: CRAM_FILTER_ALIGN_BWAMEM2_FIXMATE_SORT {
//        ext.args    = ''
//        ext.args1   = '-F0xB00 -nt'
//        ext.args2   = { "-5SPCp -H'${rglines}'" }
//        ext.args3   = '-mpu'
//        ext.args4   = { "-F0xf00 -e 'mapq>=10'" }
//        ext.args5   = { '--write-index -l1' }
//    }
//
//    withName: CRAM_FILTER_MINIMAP2_FILTER5END_FIXMATE_SORT {
//        ext.args        = ""
//        ext.args1       = ""
//        ext.args2       = { "-ax sr" }
//        ext.args3       = "-mpu"
//        ext.args4       = { "--write-index -l1" }
//    }
//
//
//    withName: '.*HIC_MAPPING:BAMTOBED_SORT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//
//    withName: '.*HIC_MAPPING.*:CONVERT_STATS:SAMTOOLS_VIEW' {
//        ext.args = "--output-fmt cram"
//    }
//
//    withName: '.*HIC_MAPPING:CONVERT_STATS:SAMTOOLS_STATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING:CONVERT_STATS:SAMTOOLS_FLAGSTAT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING:CONVERT_STATS:SAMTOOLS_IDXSTATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    // Set up of the scffolding pipeline
//    withName: '.*SCAFFOLDING:YAHS' {
//        ext.prefix = 'out'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING:COOLER_CLOAD' {
//        // Positions in the input file are zero-based;
//        // chrom1 field number (one-based) is 2;
//        // pos1 field number (one-based) is 3;
//        // chrom2 field number (one-based) is 6;
//        // pos2 field number (one-based) is 7
//        ext.args = 'pairs -0 -c1 2 -p1 3 -c2 6 -p2 7'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING:PRETEXTSNAPSHOT' {
//        // Make one plot containing all sequences
//        ext.args = '--sequences \"=full\"'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING:JUICER_TOOLS_PRE' {
//        ext.juicer_tools_jar = 'juicer_tools.1.9.9_jcuda.0.8.jar'
//        ext.juicer_jvm_params = '-Xms1g -Xmx6g'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING:JUICER_PRE' {
//        ext.args2 = "LC_ALL=C sort -k2,2d -k6,6d -S50G | awk '\$3>=0 && \$7>=0'"
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS:GFASTATS_PRI' {
//        ext.prefix = { "${meta.id}_scaffolds_final" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS:BUSCO_PRI' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs/out_scaffolds_final.${meta.lineage}.busco" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                    filename.endsWith('full_table.tsv') ? filename :
//                    filename.endsWith('missing_busco_list.tsv') ? filename :
//                    filename.startsWith('short_summary') ? filename :
//                    filename.endsWith('busco.batch_summary.txt') ? filename :
//                    null }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS:MERQURYFK_MERQURYFK' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasm}/scaffolding/yahs/out.break.yahs/out_scaffolds_final.ccs.merquryk" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    // Scaffolding hap1/hap2
//    if (params.hifiasm_hic_on) {
//
//    withName: '.*HIC_MAPPING_HAP.*:SAMTOOLS_MARKDUP_HIC_MAPPING' {
//        ext.prefix  = { "${meta.id}_mkdup" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_HAP.*:BAMTOBED_SORT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//
//    withName: '.*HIC_MAPPING_HAP.*:CONVERT_STATS:SAMTOOLS_STATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_HAP.*:CONVERT_STATS:SAMTOOLS_FLAGSTAT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_HAP.*:CONVERT_STATS:SAMTOOLS_IDXSTATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_HAP.*:YAHS' {
//        ext.prefix = { "${meta.hap_id}" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//
//    }
//
//    withName: '.*SCAFFOLDING_HAP.*:COOLER_CLOAD' {
//        // Positions in the input file are zero-based;
//        // chrom1 field number (one-based) is 2;
//        // pos1 field number (one-based) is 3;
//        // chrom2 field number (one-based) is 6;
//        // pos2 field number (one-based) is 7
//        ext.args = 'pairs -0 -c1 2 -p1 3 -c2 6 -p2 7'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_HAP.*:PRETEXTSNAPSHOT' {
//        // Make one plot containing all sequences
//        ext.args = '--sequences \"=full\"'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_HAP.*:JUICER_TOOLS_PRE' {
//        ext.juicer_tools_jar = 'juicer_tools.1.9.9_jcuda.0.8.jar'
//        ext.juicer_jvm_params = '-Xms1g -Xmx6g'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_HAP.*:JUICER_PRE' {
//        ext.args2 = "LC_ALL=C sort -k2,2d -k6,6d -S50G | awk '\$3>=0 && \$7>=0'"
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_MAT' {
//        ext.prefix = { "${meta.id}.asm.mat_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*RAW_ASSEMBLY:GFA_TO_FASTA_PAT' {
//        ext.prefix = { "${meta.id}.asm.pat_ctg" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    }
//
//    // End of hap1/hap2 scaffolding
//
//    // start of PAT/MAT scaffolding
//    if (params.hifiasm_trio_on) {
//
//    withName: '.*HIC_MAPPING_HAP.*:SAMTOOLS_MARKDUP_HIC_MAPPING' {
//        ext.prefix  = { "${meta.id}_mkdup" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_HAP.*:BAMTOBED_SORT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//
//    withName: '.*HIC_MAPPING_.*AT.*:CONVERT_STATS:SAMTOOLS_STATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_.*AT.*:CONVERT_STATS:SAMTOOLS_FLAGSTAT' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*HIC_MAPPING_.*AT.*:CONVERT_STATS:SAMTOOLS_IDXSTATS' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_.*AT.*:YAHS' {
//        ext.prefix = { "${meta.hap_id}" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//
//    }
//
//    withName: '.*SCAFFOLDING_.*AT.*:COOLER_CLOAD' {
//        // Positions in the input file are zero-based;
//        // chrom1 field number (one-based) is 2;
//        // pos1 field number (one-based) is 3;
//        // chrom2 field number (one-based) is 6;
//        // pos2 field number (one-based) is 7
//        ext.args = 'pairs -0 -c1 2 -p1 3 -c2 6 -p2 7'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_.*AT.*:PRETEXTSNAPSHOT' {
//        // Make one plot containing all sequences
//        ext.args = '--sequences \"=full\"'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_.*AT.*:JUICER_TOOLS_PRE' {
//        ext.juicer_tools_jar = 'juicer_tools.1.9.9_jcuda.0.8.jar'
//        ext.juicer_jvm_params = '-Xms1g -Xmx6g'
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*SCAFFOLDING_.*AT.*:JUICER_PRE' {
//        ext.args2 = "LC_ALL=C sort -k2,2d -k6,6d -S50G | awk '\$3>=0 && \$7>=0'"
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmtrio}/scaffolding_${meta.hap_id}/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_TRIO:MERQURYFK_MERQURYFK' {
//        ext.args   = '-lfs'
//    }
//
//    }
//
//    //end of trio scaffolding
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_HAPS:GFASTATS_PRI' {
//        ext.prefix = { "${meta.id}_scaffolds_final" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_hap1/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_HAPS:GFASTATS_HAP' {
//        ext.prefix = { "${meta.id}_scaffolds_final" }
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_hap2/yahs/out.break.yahs" },
//            mode: params.publish_dir_mode,
//            pattern: '*assembly_summary'
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_HAPS:BUSCO_PRI' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_hap1/yahs/out.break.yahs/out_scaffolds_final.${meta.lineage}.busco" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                    filename.endsWith('full_table.tsv') ? filename :
//                    filename.endsWith('missing_busco_list.tsv') ? filename :
//                    filename.startsWith('short_summary') ? filename :
//                    filename.endsWith('busco.batch_summary.txt') ? filename :
//                    null }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_HAPS:BUSCO_HAP' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_hap2/yahs/out.break.yahs/out_scaffolds_final.${meta.lineage}.busco" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.endsWith('busco.log') ? filename :
//                    filename.endsWith('full_table.tsv') ? filename :
//                    filename.endsWith('missing_busco_list.tsv') ? filename :
//                    filename.startsWith('short_summary') ? filename :
//                    filename.endsWith('busco.batch_summary.txt') ? filename :
//                    null }
//        ]
//    }
//
//    withName: '.*GENOME_STATISTICS_SCAFFOLDS_HAPS:MERQURYFK_MERQURYFK' {
//        publishDir = [
//            path: { "${params.outdir}/${meta.id}.${params.hifiasmhic}/scaffolding_hap1/yahs/out.break.yahs/out_scaffolds_final.ccs.merquryk" },
//            mode: params.publish_dir_mode,
//            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
//        ]
//    }

//    //Set up of assembly stats subworkflow
//    withName: 'BUSCO' {
//        ext.args = "--mode genome"
//    }
//    //End of Set up of assembly stats subworkflow

}


/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Extra profiles defined to override some of the above parameters
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Importantly, these profiles *cannot* be defined in the main `nextflow.config`,
    otherwise they would be loaded _before_ this `conf/modules.config`.
----------------------------------------------------------------------------------------
*/
profiles {
    test {
        process {
            // Set up of the scaffolding pipeline
            withName: 'YAHS' {
                // Skip the initial assembly error correction step
                ext.args = '-r 1000,2000,5000'
            }

            withName: '.*OATK' {
                // Set kmer size and minimal coverage
                ext.args = "-k1001 -c5 -Ttmp"
            }
        }
    }
}
