/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for running minimal tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Defines input files and everything required to run a fast and simple pipeline test.

    Use as follows:
        nextflow run sanger-tol/genomeassembly -profile test,<docker/singularity> --outdir <OUTDIR>

----------------------------------------------------------------------------------------
*/

params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'

    // Limit resources so that this can run on GitHub Actions

    // Input data
    // TODO nf-core: Specify the paths to your test data on nf-core/test-datasets
    // TODO nf-core: Give any required params for the test so that command line flags are not needed
    input = "${projectDir}/assets/test.yaml"
    groups = 10
}

process {

    withName: LONGRANGER_ALIGN {

        ext.args = "--disable-ui --nopreflight"
        
        if(System.getenv('GITHUB_ACTION') != null ) {
           container = "ghcr.io/sanger-tol/longranger:2.2.2-c3"
        }
    }

    withName: BCFTOOLS_CONSENSUS {
        ext.args = '-i\'QUAL>1 && (GT="AA" || GT="Aa")\' -Hla'
    }

    withName: BCFTOOLS_INDEX {
        ext.args = '--tbi'
    }

    withName: BCFTOOLS_VIEW {
        ext.args = '--no-version -e\'type="ref"||REF~"N"\''
    }

    withName: BCFTOOLS_NORM {
        ext.args = '--no-version'
    }

}
